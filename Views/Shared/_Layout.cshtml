<!DOCTYPE html>
@using Newfactjo.Models
@using Newfactjo.Data
@inject AppDbContext _context
@inject Newfactjo.Services.PermissionService permissionService

@{
    var today = DateTime.Now;
    var hijri = new System.Globalization.HijriCalendar();
    var hijriDate = $"{hijri.GetDayOfMonth(today)} {System.Globalization.CultureInfo.GetCultureInfo("ar-SA").DateTimeFormat.GetMonthName(hijri.GetMonth(today))} {hijri.GetYear(today)} هـ";
    var gregDate = today.ToString("dddd، dd MMMM yyyy", new System.Globalization.CultureInfo("ar-JO"));
    var userRole = Context.Session.GetString("AdminRole");
}

<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - factjo</title>
    <link rel="icon" type="image/png" href="~/images/favicon.png" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <!-- ✅ فقط هذه النسختين من slick -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

               
    <link rel="stylesheet" href="~/css/site.css" />
    <link rel="stylesheet" href="~/css/responsive.css" />
    <link rel="stylesheet" href="~/css/Fix-navbar-logo-spacing.css" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
   


    <style>
        html {
            font-size: 13px;
        }

        @@media (min-width: 1600px) {
            html

        {
            font-size: 15px;
        }

        }

        @@media (min-width: 1920px) {
            html

        {
            font-size: 16px;
        }

        }

        body {
            font-family: 'Tajawal', sans-serif;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .navbar-brand img {
            height: 48px;
        }

        .home-btn {
            background-color: black;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

            .home-btn i {
                color: white;
                font-size: 20px;
            }

            .home-btn:hover {
                background-color: #28a745;
                box-shadow: 0 0 8px rgba(0, 128, 0, 0.5);
            }

        .ticker-wrapper {
            overflow: hidden;
            background-color: #9b040c;
            color: white;
            font-weight: bold;
            padding: 4px 12px;
            font-size: 10pt;
            white-space: nowrap;
        }

        .ticker-content {
            display: inline-block;
            animation: ticker 60s linear infinite;
        }

            .ticker-content:hover {
                animation-play-state: paused;
            }

        @@keyframes ticker {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .border-frame {
            position: relative;
            padding: 0 20px;
            max-width: 1140px;
            margin: 0 auto;
        }

            .border-frame::before,
            .border-frame::after {
                content: "";
                position: fixed;
                top: 0px;
                bottom: 0;
                width: 5px;
                background-color: #dc3545;
                z-index: 9999;
            }

            .border-frame::before {
                right: calc(50% - 550px);
            }

            .border-frame::after {
                left: calc(50% - 550px);
            }

        .middle-image {
            max-height: 80px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

            .middle-image:hover {
                transform: scale(1.08);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

        @@media (max-width: 767.98px) {
            .site-logo

        {
            height:120px;
        }

        .middle-image {
            max-height: 45px;
        }

            .ad-left, .ad-right {
                position: fixed;
                top: 120px; /* المسافة من الأعلى حسب التنسيق العام */
                width: 160px;
                z-index: 999;
            }

            .ad-left {
                left: 10px;
            }

            .ad-right {
                right: 10px;
            }

                .ad-left img, .ad-right img {
                    width: 100%;
                    height: auto;
                    border: 1px solid #ccc;
                    border-radius: 6px;
                    box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
                }
            /* إخفاء الإعلانات على الشاشات الصغيرة */
        @@media (max-width: 1199px) {
                .ad-left, .ad-right

        {
            display: none;
        }

        }
        }
    </style>

    <link rel="stylesheet" href="~/css/components/_TopBarNews.css" />
</head>
<body>

  @await Html.PartialAsync("_Topbar")
     
        @if (!string.IsNullOrEmpty(userRole) && (
        permissionService.HasPermission(userRole, "ManageNews") ||
        permissionService.HasPermission(userRole, "ManageArticles") ||
        permissionService.HasPermission(userRole, "ManageUsers") ||
        permissionService.HasPermission(userRole, "ManageAds") ||
        permissionService.HasPermission(userRole, "ManageLogs") ||
        permissionService.HasPermission(userRole, "ManageHiddenCategories")
        ))
        {
            <div class="bg-light py-1 border-top">
                <div class="container d-flex justify-content-center gap-2 flex-wrap">

                    <a class="btn btn-danger text-white fw-bold" asp-controller="Home" asp-action="Index">الرئيسية</a>

                    @if (permissionService.HasPermission(userRole, "ManageNews"))
                    {
                        <a class="btn btn-danger text-white fw-bold" asp-controller="News" asp-action="Index">الأخبار</a>
                    }

                    @if (permissionService.HasPermission(userRole, "ManageArticles"))
                    {
                        <a class="btn btn-danger text-white fw-bold" asp-controller="Articles" asp-action="Index">المقالات</a>
                    }

                    <a class="btn btn-danger text-white fw-bold" asp-controller="Home" asp-action="About">من نحن</a>

                    @if (permissionService.HasPermission(userRole, "ManageUsers") ||
                   permissionService.HasPermission(userRole, "ManageAds") ||
                   permissionService.HasPermission(userRole, "ManageLogs") ||
                   permissionService.HasPermission(userRole, "ManageHiddenCategories"))
                    {
                        <a class="btn btn-dark text-white fw-bold" asp-controller="Dashboard" asp-action="Index">لوحة التحكم</a>
                    }

                    @if (Context.Session.GetString("AdminUsername") != null)
                    {
                        <form asp-controller="Admin" asp-action="Logout" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-outline-danger fw-bold">تسجيل الخروج</button>
                        </form>
                    }
                </div>
            </div>
        }



    @if (ViewData["FullWidth"] as string == "container-fluid")
    {
        <!-- ✅ عرض كامل مع أعمدة جانبية -->
        <div class="container-fluid mt-1">
            <div class="row">
                <!-- 🟥 برامجنا (يظهر فقط على md وما فوق) -->
                <div class="col-md-2 d-none d-md-block"> <!--الجزء الايمن-->
                    <!-- 🔲 ضع هنا الإعلان -->
                    <div class="bg-light border p-2 mb-2 text-center">
                        <span class="d-block mb-1 fw-bold">🔴 برامجنا</span>

                        <a href="/Home/OurPrograms">
                            <video autoplay muted loop playsinline
                                   class="img-fluid"
                                   title="عرض جميع البرامج"
                                   style="max-width: 100%; height: 150px; object-fit: cover; cursor: pointer;">
                                <source src="/ads/promo_programs.mp4" type="video/mp4" />
                                متصفحك لا يدعم تشغيل الفيديو.
                            </video>
                        </a>

                    </div>

                    <div class="bg-light border p-2 mb-2 text-center">
                        <span>🔴 إعلان </span>
                        <img src="/ads/ad-left.jpg" class="img-fluid" alt="Ad Left" style="max-width: 100%; height: 150px; object-fit: contain;" />

                    </div>
                </div>

                <!-- ✅ محتوى الصفحة -->
                <div class="col-12 col-md-8">
                    @RenderBody()
                </div>

                <!-- 🟩 الجزء الايسر من الصفحة (يظهر فقط على md وما فوق) -->
                <div class="col-md-2 d-none d-md-block">
                    <!-- 🔲 ضع هنا الإعلان -->
                    <div class="bg-light border p-2 mb-2 text-center">
                        <span>🟢 إعلان </span>
                        <img src="/ads/ad-right.jpg" class="img-fluid" alt="Ad Right" style="max-width: 100%; height: 150px; object-fit: contain;" />

                    </div>
                    <div class="col-md-12 d-none d-md-block">
                        <!-- ✅ قسم الأخبار المقترحة -->
                        @await Component.InvokeAsync("SuggestedNews")
                    </div>


                </div>
            </div>
        </div>
    }
    else
    {
        <!-- ✅ الوضع العادي لباقي الصفحات -->
        <main class="mt-1 container">
            @RenderBody()
        </main>
    }

  

   
    <!-- ✅ تحميل المكتبات بالترتيب الصحيح -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ✅ تفعيل Slick Slider بعد تحميل jQuery و Slick -->
    <script>
        function initSlickIfReady() {
            const $slider = $('.topbar-news-slider');
            if ($slider.length && typeof $slider.slick === 'function' && !$slider.hasClass('slick-initialized')) {
                $slider.slick({
                    rtl: true,
                    slidesToShow: 5,
                    autoplay: true,
                    autoplaySpeed: 3000,
                    arrows: false,
                    dots: false,
                    pauseOnHover: true,
                    responsive: [
                        { breakpoint: 992, settings: { slidesToShow: 3 } },
                        { breakpoint: 768, settings: { slidesToShow: 2 } },
                        { breakpoint: 576, settings: { slidesToShow: 1 } }
                    ]
                });
                console.log("✅ Slick initialized by observer");
            }
        }

        const observer = new MutationObserver(function () {
            initSlickIfReady();
        });

        observer.observe(document.body, { childList: true, subtree: true });

        window.addEventListener('load', function () {
            setTimeout(initSlickIfReady, 300);
        });
    </script>




        @RenderSection("Scripts", required: false)

    <!-- Lightbox markup -->
    <div id="lb" class="lightbox-backdrop" aria-hidden="true">
        <span class="close" aria-label="Close">&times;</span>
        <img alt="">
    </div>

    <!-- Footer (مؤقتًا النسخة القديمة البسيطة لنتأكد من ظهوره) -->
    <footer class="bg-dark text-white text-center py-3 mt-5">
        جميع الحقوق محفوظة &copy; @DateTime.Now.Year - Newfactjo
    </footer>

    <!-- Lightbox script (مغلق بالكامل) -->
    <script>
        (function(){
          const lb=document.getElementById('lb');
          if(!lb) return;
          const img=lb.querySelector('img');
          const close=lb.querySelector('.close');

          document.addEventListener('click',function(e){
            const t=e.target.closest('[data-lightbox-src]');
            if(t){
              e.preventDefault();
              img.src=t.getAttribute('data-lightbox-src');
              lb.classList.add('active');
            }
          });

          close.addEventListener('click',()=>lb.classList.remove('active'));
          lb.addEventListener('click',e=>{ if(e.target===lb) lb.classList.remove('active'); });
          document.addEventListener('keydown',e=>{ if(e.key==='Escape') lb.classList.remove('active'); });
        })();
    </script>
</body>
</html>
